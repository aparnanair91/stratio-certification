{"id":"519fe9a2-a859-412e-8834-91b9e57d9b60","name":"credit-scoring-use-case","description":"","settings":{"global":{"executionMode":"marathon","userPluginsJars":[],"preExecutionSqlSentences":[],"postExecutionSqlSentences":[],"addAllUploadedPlugins":false,"mesosConstraint":"","mesosConstraintOperator":"CLUSTER","parametersLists":["Environment"],"parametersUsed":["Global.DEFAULT_DELIMITER","Global.SPARK_CORES_MAX","Global.SPARK_DRIVER_CORES","Global.SPARK_DRIVER_JAVA_OPTIONS","Global.SPARK_DRIVER_MEMORY","Global.SPARK_EXECUTOR_CORES","Global.SPARK_EXECUTOR_EXTRA_JAVA_OPTIONS","Global.SPARK_EXECUTOR_MEMORY","Global.SPARK_LOCALITY_WAIT","Global.SPARK_LOCAL_PATH","Global.SPARK_MEMORY_FRACTION","Global.SPARK_TASK_MAX_FAILURES"],"udfsToRegister":[],"udafsToRegister":[],"mesosRole":"","marathonDeploymentSettings":{"gracePeriodSeconds":"240","intervalSeconds":"20","timeoutSeconds":"20","maxConsecutiveFailures":"3","forcePullImage":true,"privileged":false,"userEnvVariables":[],"userLabels":[],"logLevel":""},"enableQualityRules":true},"streamingSettings":{"window":"2s","blockInterval":"100ms","checkpointSettings":{"checkpointPath":"sparta/checkpoint","enableCheckpointing":true,"autoDeleteCheckpoint":true,"addTimeToCheckpointPath":false}},"sparkSettings":{"master":"mesos://zk://master.mesos:2181/mesos","sparkKerberos":true,"sparkDataStoreTls":true,"sparkMesosSecurity":true,"submitArguments":{"userArguments":[],"deployMode":"client","driverJavaOptions":"{{{Global.SPARK_DRIVER_JAVA_OPTIONS}}}"},"sparkConf":{"sparkResourcesConf":{"coresMax":"{{{Global.SPARK_CORES_MAX}}}","executorMemory":"{{{Global.SPARK_EXECUTOR_MEMORY}}}","executorCores":"{{{Global.SPARK_EXECUTOR_CORES}}}","driverCores":"{{{Global.SPARK_DRIVER_CORES}}}","driverMemory":"{{{Global.SPARK_DRIVER_MEMORY}}}","mesosExtraCores":"","localityWait":"{{{Global.SPARK_LOCALITY_WAIT}}}","taskMaxFailures":"{{{Global.SPARK_TASK_MAX_FAILURES}}}","sparkMemoryFraction":"{{{Global.SPARK_MEMORY_FRACTION}}}","sparkParallelism":""},"sparkHistoryServerConf":{"enableHistoryServerMonitoring":false,"sparkHistoryServerEventLogRotateEnable":false,"sparkHistoryServerEventLogRotateNum":"9","sparkHistoryServerEventLogRotateSize":"512"},"userSparkConf":[],"coarse":true,"sparkUser":"","sparkLocalDir":"{{{Global.SPARK_LOCAL_PATH}}}","sparkKryoSerialization":false,"sparkSqlCaseSensitive":true,"logStagesProgress":false,"hdfsTokenCache":true,"executorExtraJavaOptions":"{{{Global.SPARK_EXECUTOR_EXTRA_JAVA_OPTIONS}}}"}},"errorsManagement":{"genericErrorManagement":{"whenError":"Error"},"transformationStepsManagement":{"whenError":"Error","whenRowError":"RowError","whenFieldError":"FieldError"},"transactionsManagement":{"sendToOutputs":[],"sendStepData":false,"sendPredecessorsData":true,"sendInputData":true}}},"pipelineGraph":{"nodes":[{"name":"GermanData","stepType":"Input","className":"CsvInputStep","classPrettyName":"Csv","arity":["NullaryToNary"],"writer":{"saveMode":"Append","tableName":"","partitionBy":"","errorTableName":"","discardTableName":""},"uiConfiguration":{"position":{"x":2.5711441040039062,"y":2.8015425640910507}},"configuration":{"inputOptions":"[]","path":"/sparta/ey_an/input/german_credit_data.csv","debugOptions":"{\"fileUploaded\":\"/tmp/sparta/debug/519fe9a2-a859-412e-8834-91b9e57d9b60/german_credit_data.csv\"}","header":true,"delimiter":"{{{Global.DEFAULT_DELIMITER}}}"},"supportedEngines":["Batch"],"executionEngine":"Batch","supportedDataRelations":["ValidData"],"lineageProperties":[]},{"name":"ExternalDataList","stepType":"Input","className":"CsvInputStep","classPrettyName":"Csv","arity":["NullaryToNary"],"writer":{"saveMode":"Append","tableName":"","partitionBy":"","errorTableName":"","discardTableName":""},"uiConfiguration":{"position":{"x":2.0224456787109375,"y":273.82471875732836}},"configuration":{"inputOptions":"[]","path":"/sparta/ey_an/input/external_list.csv","debugOptions":"{\"fileUploaded\":\"/tmp/sparta/debug/519fe9a2-a859-412e-8834-91b9e57d9b60/external_list.csv\"}","header":true,"delimiter":"{{{Global.DEFAULT_DELIMITER}}}"},"supportedEngines":["Batch"],"executionEngine":"Batch","supportedDataRelations":["ValidData"],"lineageProperties":[]},{"name":"MatchingSubsetSelection","stepType":"Transformation","className":"FilterTransformStep","classPrettyName":"Filter","arity":["UnaryToNary"],"writer":{"saveMode":"Append","tableName":"","partitionBy":"","errorTableName":"","discardTableName":""},"uiConfiguration":{"position":{"x":197.9643783569336,"y":274.57762555664476}},"configuration":{"filterExp":"ID < 1000","inputSchemas":"[]"},"supportedEngines":["Streaming","Batch"],"executionEngine":"Batch","supportedDataRelations":["ValidData","DiscardedData"],"lineageProperties":[]},{"name":"ColumnCasting","stepType":"Transformation","className":"CastingTransformStep","classPrettyName":"Casting","arity":["UnaryToNary"],"writer":{"saveMode":"Append","tableName":"","partitionBy":"","errorTableName":"","discardTableName":""},"uiConfiguration":{"position":{"x":2.1874160766601562,"y":127.48173932617601}},"configuration":{"outputFieldsFrom":"FIELDS","inputSchemas":"[]","fields":[{"name":"Age","type":"integer","nullable":true},{"name":"Credit amount","type":"float","nullable":true},{"name":"Duration","type":"integer","nullable":true},{"name":"Checking account","type":"string","nullable":true},{"name":"Housing","type":"string","nullable":true},{"name":"ID","type":"string","nullable":true},{"name":"Purpose","type":"string","nullable":true},{"name":"Saving accounts","type":"string","nullable":true}],"whenFieldError":"","whenRowError":""},"supportedEngines":["Streaming","Batch"],"executionEngine":"Batch","supportedDataRelations":["ValidData","DiscardedData"],"lineageProperties":[]},{"name":"ColumnRename","stepType":"Transformation","className":"RenameColumnTransformStep","classPrettyName":"RenameColumns","arity":["UnaryToNary"],"writer":{"saveMode":"Append","tableName":"","partitionBy":"","errorTableName":"","discardTableName":""},"uiConfiguration":{"position":{"x":207.7112882011503,"y":4.670829725946987}},"configuration":{"columns":[{"name":"Checking account","alias":"Checking_account"},{"name":"Credit amount","alias":"Credit_amount"},{"name":"Saving accounts","alias":"Saving_account"}],"inputSchemas":"[]"},"supportedEngines":["Streaming","Batch"],"executionEngine":"Batch","supportedDataRelations":["ValidData"],"lineageProperties":[]},{"name":"Vectorisation","stepType":"Transformation","className":"TriggerTransformStep","classPrettyName":"Trigger","arity":["BinaryToNary","UnaryToNary","NaryToNary"],"writer":{"saveMode":"Append","tableName":"","partitionBy":"","errorTableName":"","discardTableName":""},"uiConfiguration":{"position":{"x":208.60980672421988,"y":125.72053058563608}},"configuration":{"sql":"Select\n\tID,\n\tCASE WHEN Checking_account = 'little' THEN 1\n\t\tELSE 0 END AS Checking_little,\n\tCASE WHEN Checking_account = 'NA' THEN 1\n\t\tELSE 0 END AS Checking_null,\n\tCASE WHEN Checking_account = 'moderate' THEN 1\n\t\tELSE 0 END AS Checking_moderate,\n\tCASE WHEN Saving_account = 'little' THEN 1\n\t\tELSE 0 END AS Savings_little,\n\tCASE WHEN Saving_account = 'NA' THEN 1\n\t\tELSE 0 END AS Savings_null,\n\tCASE WHEN Purpose = 'radio/TV' THEN 1\n\t\tELSE 0 END AS Purpose_radioTV,\n\tCASE WHEN Housing = 'own' THEN 1\n\t\tELSE 0  END AS Housing_own,\n\tCASE WHEN Credit_amount > 10000 THEN 1\n\t\tELSE 0  END AS Credit_big,\n\tCASE WHEN Duration < 12 THEN 1\n\t\tELSE 0  END AS Duration_short,\n\tCASE WHEN Age < 27 THEN 1\n\t\tELSE 0  END AS Age_young\nfrom ColumnRename","discardConditions":"[]","inputSchemas":"[]","executeSqlWhenEmpty":true},"supportedEngines":["Batch"],"executionEngine":"Batch","supportedDataRelations":["ValidData","DiscardedData"],"lineageProperties":[]},{"name":"VectorizedColRename","stepType":"Transformation","className":"RenameColumnTransformStep","classPrettyName":"RenameColumns","arity":["UnaryToNary"],"writer":{"saveMode":"Append","tableName":"","partitionBy":"","errorTableName":"","discardTableName":""},"uiConfiguration":{"position":{"x":409.80466874971603,"y":4.434915428678778}},"configuration":{"columns":[{"name":"Purpose_radioTV","alias":"Purpose_radio/TV"}],"inputSchemas":"[]"},"supportedEngines":["Streaming","Batch"],"executionEngine":"Batch","supportedDataRelations":["ValidData"],"lineageProperties":[]},{"name":"MLPrediction","stepType":"Transformation","className":"MlModelTransformStep","classPrettyName":"MlModel","arity":["UnaryToNary"],"writer":{"saveMode":"Append","tableName":"","partitionBy":"","errorTableName":"","discardTableName":""},"uiConfiguration":{"position":{"x":408.5839058281791,"y":132.66000202413085}},"configuration":{"selectMlType":"ML_MODEL_URL","model":"an-decisiontree-model","inputSchemas":"[]"},"supportedEngines":["Streaming","Batch"],"executionEngine":"Batch","supportedDataRelations":["ValidData"],"lineageProperties":[]},{"name":"ObtainRiskProbability","stepType":"Transformation","className":"TriggerTransformStep","classPrettyName":"Trigger","arity":["BinaryToNary","UnaryToNary","NaryToNary"],"writer":{"saveMode":"Append","tableName":"","partitionBy":"","errorTableName":"","discardTableName":""},"uiConfiguration":{"position":{"x":606.1565348379899,"y":6.101503431719323}},"configuration":{"sql":"select ID, probability.values[1] as probability from MLPrediction","discardConditions":"[]","inputSchemas":"[]","executeSqlWhenEmpty":true},"supportedEngines":["Batch"],"executionEngine":"Batch","supportedDataRelations":["ValidData","DiscardedData"],"lineageProperties":[]},{"name":"Join","stepType":"Transformation","className":"JoinTransformStep","classPrettyName":"Join","arity":["BinaryToNary"],"writer":{"saveMode":"Append","tableName":"","partitionBy":"","errorTableName":"","discardTableName":""},"uiConfiguration":{"position":{"x":823.3577897851171,"y":125.57562541493724}},"configuration":{"rightTable":"ExternalDataCasted","leftTable":"ObtainRiskProbability","inputSchemas":"[]","joinConditions":[{"leftField":"ID","rightField":"ID_external"}],"joinType":"INNER","joinReturn":"ALL"},"supportedEngines":["Batch","Streaming"],"executionEngine":"Batch","supportedDataRelations":["ValidData"],"lineageProperties":[]},{"name":"KeyColumnRename","stepType":"Transformation","className":"RenameColumnTransformStep","classPrettyName":"RenameColumns","arity":["UnaryToNary"],"writer":{"saveMode":"Append","tableName":"","partitionBy":"","errorTableName":"","discardTableName":""},"uiConfiguration":{"position":{"x":403.73403755695017,"y":274.3862804613185}},"configuration":{"columns":[{"name":"ID","alias":"ID_external"}],"inputSchemas":"[]"},"supportedEngines":["Streaming","Batch"],"executionEngine":"Batch","supportedDataRelations":["ValidData"],"lineageProperties":[]},{"name":"ExternalDataCasted","stepType":"Transformation","className":"CastingTransformStep","classPrettyName":"Casting","arity":["UnaryToNary"],"writer":{"saveMode":"Append","tableName":"","partitionBy":"","errorTableName":"","discardTableName":""},"uiConfiguration":{"position":{"x":604.7937990819887,"y":274.67031097897666}},"configuration":{"outputFieldsFrom":"FIELDS","inputSchemas":"[]","fields":[{"name":"ID_external","type":"string","nullable":true},{"name":"AddressFraudCheck","type":"integer","nullable":true},{"name":"ContactAudit","type":"integer","nullable":true},{"name":"FraudSuspicion","type":"integer","nullable":true},{"name":"LegalCase","type":"integer","nullable":true},{"name":"PoliceReport","type":"integer","nullable":true},{"name":"UkvCheck","type":"integer","nullable":true}],"whenFieldError":"","whenRowError":""},"supportedEngines":["Streaming","Batch"],"executionEngine":"Batch","supportedDataRelations":["ValidData","DiscardedData"],"lineageProperties":[]},{"name":"CalculateTotalFraud","stepType":"Transformation","className":"TriggerTransformStep","classPrettyName":"Trigger","arity":["BinaryToNary","UnaryToNary","NaryToNary"],"writer":{"saveMode":"Append","tableName":"","partitionBy":"","errorTableName":"","discardTableName":""},"uiConfiguration":{"position":{"x":1001.6337750928653,"y":125.99507237479827}},"configuration":{"sql":"select ID, probability, AddressFraudCheck, ContactAudit, FraudSuspicion, LegalCase, PoliceReport, \nUkvCheck, \nAddressFraudCheck + ContactAudit + FraudSuspicion + LegalCase + PoliceReport + UkvCheck as TotalFraud\nfrom Join\n","discardConditions":"[]","inputSchemas":"[]","executeSqlWhenEmpty":true},"supportedEngines":["Batch"],"executionEngine":"Batch","supportedDataRelations":["ValidData","DiscardedData"],"lineageProperties":[]},{"name":"RedFilter","stepType":"Transformation","className":"FilterTransformStep","classPrettyName":"Filter","arity":["UnaryToNary"],"writer":{"saveMode":"Append","tableName":"","partitionBy":"","errorTableName":"","discardTableName":""},"uiConfiguration":{"position":{"x":1186.4347610576763,"y":1.105954728250481}},"configuration":{"filterExp":"probability >= 0.6 or TotalFraud >= 2","inputSchemas":"[]"},"supportedEngines":["Streaming","Batch"],"executionEngine":"Batch","supportedDataRelations":["ValidData","DiscardedData"],"lineageProperties":[]},{"name":"GreenFilter","stepType":"Transformation","className":"FilterTransformStep","classPrettyName":"Filter","arity":["UnaryToNary"],"writer":{"saveMode":"Append","tableName":"","partitionBy":"","errorTableName":"","discardTableName":""},"uiConfiguration":{"position":{"x":1186.6509607431976,"y":121.00779705570892}},"configuration":{"filterExp":"probability <= 15 and TotalFraud = 0","inputSchemas":"[]"},"supportedEngines":["Streaming","Batch"],"executionEngine":"Batch","supportedDataRelations":["ValidData","DiscardedData"],"lineageProperties":[]},{"name":"AddRedClass","stepType":"Transformation","className":"AddColumnsTransformStep","classPrettyName":"AddColumns","arity":["UnaryToNary"],"writer":{"saveMode":"Append","tableName":"","partitionBy":"","errorTableName":"","discardTableName":""},"uiConfiguration":{"position":{"x":1394.271808142662,"y":2.5576171875}},"configuration":{"selectType":"COLUMNS","columns":[{"field":"Class","query":"Red","type":"string"}],"inputSchemas":"[]"},"supportedEngines":["Streaming","Batch"],"executionEngine":"Batch","supportedDataRelations":["ValidData"],"lineageProperties":[]},{"name":"AddGreenClass","stepType":"Transformation","className":"AddColumnsTransformStep","classPrettyName":"AddColumns","arity":["UnaryToNary"],"writer":{"saveMode":"Append","tableName":"","partitionBy":"","errorTableName":"","discardTableName":""},"uiConfiguration":{"position":{"x":1396.9168512239444,"y":117.64835075473633}},"configuration":{"selectType":"COLUMNS","columns":[{"field":"Class","query":"Green","type":"string"}],"inputSchemas":"[]"},"supportedEngines":["Streaming","Batch"],"executionEngine":"Batch","supportedDataRelations":["ValidData"],"lineageProperties":[]},{"name":"AddYellowClass","stepType":"Transformation","className":"AddColumnsTransformStep","classPrettyName":"AddColumns","arity":["UnaryToNary"],"writer":{"saveMode":"Append","tableName":"","partitionBy":"","errorTableName":"","discardTableName":""},"uiConfiguration":{"position":{"x":1394.2583361099087,"y":251.71930854561992}},"configuration":{"selectType":"COLUMNS","columns":[{"field":"Class","query":"Yellow","type":"string"}],"inputSchemas":"[]"},"supportedEngines":["Streaming","Batch"],"executionEngine":"Batch","supportedDataRelations":["ValidData"],"lineageProperties":[]},{"name":"merged","stepType":"Transformation","className":"UnionTransformStep","classPrettyName":"Union","arity":["NaryToNary"],"writer":{"saveMode":"Append","tableName":"","partitionBy":"","errorTableName":"","discardTableName":""},"uiConfiguration":{"position":{"x":1633.0422665529545,"y":116.94041319438242}},"configuration":{"inputSchemas":"[]"},"supportedEngines":["Streaming","Batch"],"executionEngine":"Batch","supportedDataRelations":["ValidData"],"lineageProperties":[]},{"name":"OutputParquet","stepType":"Output","className":"ParquetOutputStep","classPrettyName":"Parquet","arity":["NullaryToNullary","NaryToNullary"],"writer":{"saveMode":"Append"},"uiConfiguration":{"position":{"x":1865.84967369055,"y":43.19324706169601}},"configuration":{"path":"/sparta/ey_an/out_parquet/","errorSink":false,"saveOptions":"[]"},"supportedEngines":["Streaming","Batch"],"executionEngine":"Batch","lineageProperties":[]},{"name":"OutputCSV","stepType":"Output","className":"CsvOutputStep","classPrettyName":"Csv","arity":["NullaryToNullary","NaryToNullary"],"writer":{"saveMode":"Append"},"uiConfiguration":{"position":{"x":1863.9340295468314,"y":232.78520606238243}},"configuration":{"path":"/sparta/ey_an/out_csv/","errorSink":false,"inferSchema":false,"header":true,"saveOptions":"[]","delimiter":"{{{Global.DEFAULT_DELIMITER}}}"},"supportedEngines":["Streaming","Batch"],"executionEngine":"Batch","lineageProperties":[]}],"edges":[{"origin":"ExternalDataList","destination":"MatchingSubsetSelection","dataType":"ValidData"},{"origin":"GermanData","destination":"ColumnCasting","dataType":"ValidData"},{"origin":"ColumnCasting","destination":"ColumnRename","dataType":"ValidData"},{"origin":"ColumnRename","destination":"Vectorisation","dataType":"ValidData"},{"origin":"Vectorisation","destination":"VectorizedColRename","dataType":"ValidData"},{"origin":"VectorizedColRename","destination":"MLPrediction","dataType":"ValidData"},{"origin":"MLPrediction","destination":"ObtainRiskProbability","dataType":"ValidData"},{"origin":"ObtainRiskProbability","destination":"Join","dataType":"ValidData"},{"origin":"MatchingSubsetSelection","destination":"KeyColumnRename","dataType":"ValidData"},{"origin":"KeyColumnRename","destination":"ExternalDataCasted","dataType":"ValidData"},{"origin":"ExternalDataCasted","destination":"Join","dataType":"ValidData"},{"origin":"Join","destination":"CalculateTotalFraud","dataType":"ValidData"},{"origin":"CalculateTotalFraud","destination":"RedFilter","dataType":"ValidData"},{"origin":"RedFilter","destination":"GreenFilter","dataType":"DiscardedData"},{"origin":"RedFilter","destination":"AddRedClass","dataType":"ValidData"},{"origin":"GreenFilter","destination":"AddGreenClass","dataType":"ValidData"},{"origin":"GreenFilter","destination":"AddYellowClass","dataType":"DiscardedData"},{"origin":"AddRedClass","destination":"merged","dataType":"ValidData"},{"origin":"AddGreenClass","destination":"merged","dataType":"ValidData"},{"origin":"AddYellowClass","destination":"merged","dataType":"ValidData"},{"origin":"merged","destination":"OutputParquet","dataType":"ValidData"},{"origin":"merged","destination":"OutputCSV","dataType":"ValidData"}]},"executionEngine":"Batch","uiSettings":{"position":{"x":20.69945253124456,"y":143.19655497749204,"k":0.6252911485019244}},"lastUpdateDate":"2019-12-30T10:44:30Z","version":0,"group":{"id":"a22289bc-5900-48f6-b5e3-03a16f2ef9db","name":"/home/ey/an"},"debugMode":false,"versionSparta":"2.10.1-998fd48","groupId":"a22289bc-5900-48f6-b5e3-03a16f2ef9db"}